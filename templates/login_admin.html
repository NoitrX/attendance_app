{% extends 'base.html' %} {% block content %}
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EduConnect - Login Admin</title>
  <!-- SweetAlert2 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
  <div class="max-w-screen min-h-screen grid grid-cols-12">
    <div
      class="col-span-12 lg:col-span-6 w-full h-full bg-black p-1 rounded-md"
    >
      <img
        src="/static/img/background_darkmode.jpg"
        class="object-cover rounded-md m-1"
        alt=""
      />
    </div>
    <div
      class="col-span-12 lg:col-span-6 bg-black flex flex-col p-24 justify-center"
    >
      <h4 class="text-white font-semibold text-6xl text-center mb-3">Login</h4>
      <p class="text-sm text-gray-300 text-center">
        Enter Your credentials to access Attendance App PnjErs
      </p>

      <form id="loginForm" action="/login-admin" method="post" class="w-full">
        <div class="flex flex-col justify-start items-start mt-4">
          <label class="text-gray-300 font-semibold text-sm" for="email"
            >Email</label
          >
          <input
            type="email"
            name="email"
            id="email"
            class="w-full bg-[#171717] text-sm text-white rounded-md px-4 py-4 mt-2"
            placeholder="Input Your Email Address"
            required
          />
        </div>

        <div class="flex flex-col justify-start items-start mt-6">
          <label class="text-gray-300 font-semibold text-sm" for="password"
            >Password</label
          >
          <div class="relative w-full mt-2">
            <input
              name="password"
              type="password"
              id="password"
              class="w-full bg-[#171717] text-sm text-white rounded-md px-4 py-4 pr-10"
              placeholder="Input Your Password"
              required
            />
            <button
              type="button"
              id="togglePassword"
              class="absolute right-4 bottom-1 top-1/2 transform -translate-y-1/2 text-gray-300 hover:text-white"
            >
              <span class="material-icons">visibility</span>
            </button>
          </div>
        </div>

        <button
          type="submit"
          class="w-full px-8 py-3 text-black font-semibold rounded-md bg-[#ffb617] mt-4 hover:bg-orange-600 hover:text-white transition-all duration-300 cursor-pointer"
        >
          Login
        </button>
      </form>
    </div>
  </div>

  <script>
    const togglePassword = document.getElementById("togglePassword");
    const passwordInput = document.getElementById("password");
    togglePassword.addEventListener("click", () => {
      const type =
        passwordInput.getAttribute("type") === "password" ? "text" : "password";
      passwordInput.setAttribute("type", type);
      togglePassword.querySelector("span").textContent =
        type === "password" ? "visibility" : "visibility_off";
    });

    // Handle form submission with AJAX
    document
      .getElementById("loginForm")
      .addEventListener("submit", async (e) => {
        e.preventDefault(); 

        const formData = new FormData(e.target);
        try {
          const response = await fetch("/login-admin", {
            method: "POST",
            body: formData,
          });
          const data = await response.json();

          if (data.success) {
            window.location.href = "/admin/dashboard"; 
          } else {
            Swal.fire({
              icon: "error",
              title: "Login Failed",
              text: data.message || "Invalid credentials. Please try again.",
              confirmButtonColor: "#ffb617",
            });
          }
        } catch (error) {
          Swal.fire({
            icon: "error",
            title: "Error",
            text: "An error occurred. Please try again later.",
            confirmButtonColor: "#ffb617",
          });
        }
      });
  </script>
</body>
{% endblock %}
